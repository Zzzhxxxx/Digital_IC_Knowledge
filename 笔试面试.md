# 1 常见问题

## 1.1 竞争冒险

```
> **组合逻辑电路出现的是竞争冒险问题，时序逻辑电路出现的是亚稳态问题。**
> 
> 跨时钟域 >> 亚稳态，异步复位 >> 亚稳态，竞争冒险 >> 逻辑错误，时序违例 >> 可能亚稳态可能逻辑错误。
> 
> 组合电路中，某一输入变量经过不同途径传输后，到达电路中某一汇合点的时间有先有后，这种现象称竞争；由于竞争而使电路输出发生瞬时错误（尖峰脉冲）的现象叫做冒险。竞争不一定有冒险，但冒险一定会有竞争。
```

---

## 1.2 时序违例

> **什么是建立时间和保持时间？为什么触发器要满足建立时间和保持时间?**
> 
> 建立时间：触发器在时钟上升沿到来之前，其数据输入端的数据必须保持不变的最小时间。
>
> 保持时间：触发器在时钟上升沿到来之后，其数据输入端的数据必须保持不变的最小时间。
>
> 因为触发器内部数据的形成需要一定的时间，如果不满足建立和保持时间，触发器将进入亚稳态，触发器的输出将不稳定。
> 
>> **时序设计的实质是？**
>>
>> 满足每一个触发器的建立/保持时间的要求。

---

> **什么是系统最快时钟频率？**
> 
> 最小时钟周期： $T_{min} = T_{co} + T_{delay} + T_{setup}$ ，最快时钟频率： $F_{max} = 1 / T_{min}$ 。
>  
> 其中 $T_{co}$ 为寄存器 `clock` 端到 `Q` 端的延迟， $T_{delay}$ 为组合路径延迟。 $T_{co}$ 和 $T_{setup}$ 是由具体的器件工艺决定的，故设计电路时只能改变组合逻辑的延迟时间 $T_{delay}$，所以说缩短触发器间组合逻辑的延时时间是提高同步电路速度的关键所在。
>
>> **公式**
>> 
>> 建立时间： $T_{co} + T_{delay(max)} + T_{setup} \leq T_{min} + T_{skew}$
>> 
>> 保持时间： $T_{co} + T_{delay(min)} \geq T_{hold} + T_{skew}$
>>
>
> 保持时间和时钟频率毫无关系，建立时间可以通过降频来满足。
> 
> 实际设计中优先满足建立时间，这也是时序收敛的关键。保持时间比较好满足，只需适当延长最短路径延迟即可。

---

> **优化时序违例的方法**
> 
> setup 违例：
> - 更换 LVT 等器件；
> - 前端插入寄存器打散组合逻辑；
> - 前端优化时钟架构的走线设计；
> - 更换驱动能力更强的 cell；
> - 收紧综合约束，减少各单元的扇出，增加 input/output delay，为后端留足够的裕量。
> 
> hold 违例：
> - 插入 buf，延长时序路径；
> - CTS 后平衡时钟树走线，避免某些 cell 有过大的时钟 skew。

---

## 1.3 跨时钟域

> **为什么两级触发器可以防止亚稳态传播？**
> 
> 两级触发器并不能消除亚稳态，它只是减少了出现亚稳态的概率，将其减小到了一个几乎可以忽略不计的程度。
> 
> 触发器进入亚稳态的时间可以用参数 MTBF（Mean Time Between Failures，平均故障间隔时间）来描述。
> 
> 两级触发器可以极大地提高 MTBF 的值，将亚稳态控制在实际应用可以接受范围内的要求。

---

> **异步信号如何进行同步？**
> 
>> **单 bit 信号**
>> 
>> 慢 > 快用目标时钟域的时钟打 2 拍。
>> 
>> 快 > 慢可能出现漏采样的情况，需要进行脉冲展宽，分为开环和闭环两种方式，开环需要让快时钟域信号展宽为慢时钟域时钟周期的 1.5 倍；闭环需要反馈信号，在慢时钟域打两拍之后再在快时钟域打两拍，反馈给快时钟域，以确保信号稳定。 
> 
>> **多 bit 信号**
>> 
>> 不同场景和需求的同步方式也有区别。
>> 
>> 比较通用的有：握手信号（延迟较高，适用于低频高可靠性场景）和异步 fifo（最常用）。
>> 
>> 特殊场景：
>> 
>> - 多 bit 数据带有使能信号，可以用 dmux。
>> 
>> - 多 bit 数据连续递增，可以用格雷码。
>> 
>> - 多 bit 同时变化或者有相位关系的控制信号，可以合并为 1bit 信号。
>
> 可参考：
> 
> - [跨时钟域处理方法详尽版](https://www.cnblogs.com/lyc-seu/p/12441366.html)
> 
> - [多 bit 信号跨时钟域处理](https://zhuanlan.zhihu.com/p/20037203994)

---

## 1.4 异步复位

---

## 1.5 低功耗设计

> **芯片功耗**
> 
> 总功耗 = 静态功耗+动态功耗 = 静态功耗+短路功耗+翻转功耗
> - 静态功耗为 $P_{static} = I_{peak} V_{DD}$ ，和电压、漏电流有关。
> - 短路功耗为 $P_{short} = \alpha Q_{SC} V_{DD} f$ ，其中 $\alpha$ 为活动因子， $Q_{SC}$ 为短路过程中传输的电荷量。
> - 翻转功耗为 $P_{switch} = \alpha C V_{DD}^2 f$ ，其中 $\alpha$ 为活动因子， $C$ 为等效电容。
> 
> RTL 设计中主要关注的是翻转功耗。因为有 4 个变量，所以可以从 4 个方面考虑低功耗设计。
> 
>> **活动因子角度**
>> 
>> 活动因子即翻转率，可以从 RTL 层面减小翻转率。
>> - 门控时钟
>> - 操作数隔离
>> - 独热码/格雷码编码
>> - 总线翻转
>
>> **电容角度**
>> 
>> 电容偏向工艺和后端。
>> - 工艺方面降低器件电容
>> - 后端进行合理布局布线
>
>> **电压角度**
>> - 降低工作电压
>> - 多电压域
>> - 电源关断技术
>> - 动态电压缩放技术 DVS（处理器在不同工作模式下使用不同电压）
>
>> **时钟频率角度**
>> - 降低工作频率
>> - 多时钟域

---

> **门控时钟**
> 
> 门控时钟是 RTL 层面非常常用的低功耗设计手段，面试时也经常被问到。
> 
> 锁存门控：
> 
> ![image-20250414230920370](https://github.com/user-attachments/assets/1f61236f-37bc-4d28-9fb4-542d7332c58f)
> 
> 寄存门控：
> 
> ![image-20250414230959656](https://github.com/user-attachments/assets/aa5ede28-f517-46ea-8701-6d22fbf30d90)
> 
> 这两种结构都可以实现时钟门控，但是因为第 1 种结构占用面积较小，所以设计中常采用第 1 种锁存门控。因此，工艺厂商会把门控时钟做出一个标准单元供设计者使用。
> 
> ![image-20250414231626985](https://github.com/user-attachments/assets/3fc0f597-f0e0-4409-88b4-049e7be8465e)
>
> 参考：[门控时钟](https://zhuanlan.zhihu.com/p/139363948)

---

## 1.6 AXI 协议

---

## 1.7 其他

---
